<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Hero</title>
    <base target="_blank">
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; overflow: hidden; }
        .hero-section {
            background-color: #064e3b; /* Deep Green */
            color: white;
            min-height: 600px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        /* Top Navigation inside Hero */
        .hero-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 60px;
            font-weight: 600;
        }
        .nav-group { display: flex; gap: 30px; }
        .nav-link { color: white; text-decoration: none; font-size: 16px; }
        .brand { font-size: 32px; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; }
        
        /* Main Content */
        .hero-content {
            text-align: center;
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }
        .subheading { font-size: 20px; margin-bottom: 20px; font-weight: 500; }
        
        .headline {
            font-size: 80px;
            line-height: 0.9;
            font-weight: 900;
            text-transform: uppercase;
            margin: 0 0 30px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .highlight-box {
            background-color: #ffc0cb; /* Pink */
            color: #3e2723; /* Dark Brown */
            padding: 0 15px;
            display: inline-block;
            --rotation: -2deg;
            transform: rotate(var(--rotation));
            margin: 5px 0;
        }
        .highlight-box:nth-child(even) { --rotation: 2deg; }

        .description {
            font-size: 18px;
            line-height: 1.5;
            max-width: 600px;
            margin: 0 auto;
            opacity: 0.9;
        }

        /* Decorative Hands (CSS Shapes/Placeholders) */
        .hand {
            position: absolute;
            bottom: -50px;
            width: 150px;
            height: 150px;
            z-index: 1;
            filter: drop-shadow(5px 5px 0px rgba(0,0,0,0.2));
            opacity: 0;
            animation: handEntrance 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            animation-delay: 0.8s;
        }
        .hand-left { left: 5%; --rotation: -10deg; transform: rotate(var(--rotation)); }
        .hand-right { right: 5%; --rotation: 10deg; transform: rotate(var(--rotation)); }

        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes handEntrance {
            from { opacity: 0; transform: translateY(100px) rotate(var(--rotation)); }
            to { opacity: 1; transform: translateY(0) rotate(var(--rotation)); }
        }
        @keyframes pressRelease {
            0% {
            }
            40% {
                opacity: 1;
            }
            70% {
                margin-top: 15px;
                margin-bottom: 15px;
                transform: scale(0.95, 1.1) rotate(var(--rotation));
            }
            100% {
                opacity: 1;
                margin-top: 5px;
                margin-bottom: 5px;
                transform: scale(1, 1) rotate(var(--rotation));
            }
        }

        .hero-content > *:not(.headline) { opacity: 0; animation: fadeInUp 0.8s ease-out forwards; }
        .subheading { animation-delay: 0.2s; }
        .headline { opacity: 1; }
        #hl-top { opacity: 0; animation: fadeInUp 0.8s ease-out forwards 0.4s; }
        .highlight-box { opacity: 0; animation: pressRelease 1.5s cubic-bezier(0.19, 1, 0.22, 1) forwards; }
        #hl-mid { animation-delay: 0.6s; }
        #hl-bot { animation-delay: 0.8s; }
        .description { animation-delay: 0.6s; }

        @media (max-width: 768px) {
            .hero-section { padding: 20px; min-height: auto; padding-bottom: 100px; }
            .headline { font-size: 42px; margin-bottom: 20px; }
            .subheading { font-size: 16px; }
            .description { font-size: 16px; }
            .hero-nav { flex-direction: column; gap: 15px; margin-bottom: 30px; }
            .nav-group { display: none; } /* Hide secondary nav on mobile to save space */
            .brand { font-size: 28px; }
            .hand { width: 80px; height: 80px; bottom: -20px; }
        }
        
        @media (max-width: 480px) {
            .headline { font-size: 36px; }
            .hand { display: none; } /* Hide hands on very small screens */
        }

        /* Loading & Error States */
        #loading, #error-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: #064e3b; color: white; z-index: 9999;
        }
        #error-screen { background: #fee2e2; color: #b91c1c; display: none; }
        #content { display: none; width: 100%; }
    </style>
</head>
<body>
    <div id="loading">
        <div>ðŸ”’ Verifying...</div>
    </div>
    <div id="error-screen">
        <h3>Access Denied</h3>
        <p id="error-msg">Invalid Token</p>
    </div>

    <div class="hero-section" id="hero" style="display: none;">
        <!-- Top Nav -->
        <div class="hero-nav">
            <div class="nav-group" id="nav-left"></div>
            <div class="brand" id="brand">BRAND</div>
            <div class="nav-group" id="nav-right"></div>
        </div>

        <!-- Content -->
        <div class="hero-content">
            <div class="subheading" id="subheading">Subheading</div>
            <h1 class="headline">
                <span id="hl-top">HEADLINE</span>
                <span class="highlight-box" id="hl-mid">HIGHLIGHT</span>
                <span class="highlight-box" id="hl-bot">HIGHLIGHT</span>
            </h1>
            <p class="description" id="desc">Description text goes here.</p>
        </div>

        <!-- Decorative Elements mimicking the hands -->
        <div class="hand hand-left">
            <!-- Peace/Victory Hand Illustration -->
            <svg viewBox="0 0 24 24" class="hand-svg">
                <path d="M16 11l2-7a2 2 0 0 0-4 0l-2 7 M8 11l-2-7a2 2 0 0 0-4 0l2 7 M2 11h20v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V11z" stroke-linejoin="round" stroke-linecap="round"/>
            </svg>
        </div>
        <div class="hand hand-right">
            <!-- Thumbs Up Illustration -->
            <svg viewBox="0 0 24 24" class="hand-svg">
                <path d="M7 11V19 M7 11H4C3 11 2 12 2 13V17C2 18 3 19 4 19H7 M7 19H16.3C17.6 19 18.7 18.1 19 16.9L20.3 11.6C20.6 10.4 19.7 9.3 18.5 9.3H14L15.3 4.6C15.5 3.8 14.8 3 14 3H13C12.5 3 12 3.2 11.7 3.6L7 11Z" stroke-linejoin="round" stroke-linecap="round"/>
            </svg>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC4qRfl2vU7rWZlQsgN5ikrtLTgzS9ehN4",
            authDomain: "komutheme.firebaseapp.com",
            projectId: "komutheme",
            storageBucket: "komutheme.firebasestorage.app",
            messagingSenderId: "27957638694",
            appId: "1:27957638694:web:daf2e849b28b46740e58e7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const params = new URLSearchParams(window.location.search);
        const token = params.get('token');
        const frameId = params.get('frame_id');

        async function verifyToken() {
            if (!token) return showError("No token provided.");
            try {
                await signInAnonymously(auth);
                const q = query(collection(db, "users"), where("premiumToken", "==", token));
                const querySnapshot = await getDocs(q);
                if (!querySnapshot.empty) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('hero').style.display = 'flex';
                    renderContent();
                } else showError("Token not found.");
            } catch (e) { console.error(e); showError("Verification failed."); }
        }

        function showError(msg) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error-screen').style.display = 'flex';
            document.getElementById('error-msg').innerText = msg;
            sendHeight();
        }
        
        function renderContent() {
        // Colors
        const bgColor = params.get('bg_color') ? '#' + params.get('bg_color') : '#064e3b';
        const accentColor = params.get('accent_color') ? '#' + params.get('accent_color') : '#ffc0cb';
        const accentText = params.get('accent_text') ? '#' + params.get('accent_text') : '#3e2723';
        const navColor = params.get('nav_color') ? '#' + params.get('nav_color') : '#ffffff';
        
        document.getElementById('hero').style.backgroundColor = bgColor;
        document.querySelectorAll('.highlight-box').forEach(el => {
            el.style.backgroundColor = accentColor;
            el.style.color = accentText;
        });
        
        document.querySelectorAll('.hand-svg').forEach(el => {
            el.style.fill = accentColor;
            el.style.stroke = accentText;
            el.style.strokeWidth = '1.5';
        });

        // Apply nav color
        document.getElementById('brand').style.color = navColor;
        // Nav links color is handled in buildNav

        // Text Content
        document.getElementById('brand').textContent = params.get('brand') || 'Brand';
        document.getElementById('subheading').textContent = params.get('subheading') || '';
        document.getElementById('hl-top').textContent = params.get('headline') || '';
        document.getElementById('hl-mid').textContent = params.get('highlight1') || '';
        document.getElementById('hl-bot').textContent = params.get('highlight2') || '';
        document.getElementById('desc').textContent = params.get('description') || '';

        // Helper to build nav links
        function buildNav(containerId, dataStr) {
            const container = document.getElementById(containerId);
            if (!dataStr) return;
            dataStr.split(',').forEach(item => {
                const [text, href] = item.split('|');
                const a = document.createElement('a');
                a.className = 'nav-link';
                a.textContent = text;
                a.href = href || '#';
                a.style.color = navColor;
                container.appendChild(a);
            });
        }

        buildNav('nav-left', params.get('nav_left'));
        buildNav('nav-right', params.get('nav_right'));
        sendHeight();
        }

        // Send height
        function sendHeight() {
            const height = document.body.scrollHeight;
            if(frameId) {
                window.parent.postMessage({ frameHeight: height, frameId: frameId }, '*');
            }
        }
        window.addEventListener('resize', sendHeight);
        verifyToken();
    </script>
</body>
</html>