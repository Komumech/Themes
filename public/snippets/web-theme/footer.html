<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* === Base Snippet Styles (Crucial for height measurement) === */
        html, body {
            margin: 0; padding: 0; height: auto; 
            overflow: hidden;
        }
        body {
            font-family: var(--font-family, sans-serif);
            color: #6c757d;
            background-color: #f8f9fa00;
        }

        /* --- Dynamic Colors (New CSS Variables for customization) --- */
        :root {
            --primary-color: #93affc; /* For hover links */
            --accent-color: #ff9a9e; /* For social icon hover */
            --header-color: #343a40; /* For column titles */
            --text-color: #6c757d;   /* For body text and links */
            --bg-color: #ffffff;    /* For footer background */
            --border-color: #e7e7e7; /* For separator line */
        }

        /* === Footer Layout === */
        .footer {
            padding: 50px 5vw;
            width: 100%;
            box-sizing: border-box;
            background-color: var(--bg-color);
        }

        .footer-content {
            display: flex; flex-wrap: wrap; justify-content: space-between;
            gap: 40px; padding-bottom: 40px;
            border-bottom: 1px solid var(--border-color);
        }

        .footer-column {
            flex: 1; min-width: 200px;
        }

        /* === Column Content Styling === */
        .footer-column h4 {
            font-size: 1.1rem; font-weight: 600;
            color: var(--header-color); /* Uses dynamic color */
            margin-bottom: 20px;
        }

        .footer-column p,
        .footer-column a {
            font-size: 0.95rem; text-decoration: none;
            color: var(--text-color); /* Uses dynamic color */
            line-height: 1.6;
        }

        .footer-column .nav-links {
            display: flex; flex-direction: column; gap: 10px;
        }

        .footer-column .nav-links a:hover {
            color: var(--primary-color); /* Uses dynamic color */
        }

        /* === Social & Copyright === */
        .social-links {
            display: flex; gap: 18px; margin-top: 15px;
        }

        .social-links a:hover {
            color: var(--accent-color); /* Uses dynamic color */
        }

        .footer-bottom {
            padding-top: 30px; text-align: center;
            font-size: 0.9rem;
            color: var(--text-color);
        }
    </style>
</head>
<body>

<div class="footer" id="footer-root">
    <div class="footer-content">
        <div class="footer-column" id="company-column">
            <h4 id="company-name">Your Company</h4>
            <p id="company-description">Making the web a more beautiful and accessible place for everyone.</p>
        </div>

        <div class="footer-column">
            <h4>Quick Links</h4>
            <div class="nav-links" id="nav-links-container">
            </div>
        </div>

        <div class="footer-column">
            <h4>Follow Us</h4>
            <div class="social-links" id="social-links-container">
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        <p id="copyright-text">&copy; 2025 Your Company. All Rights Reserved.</p>
    </div>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const rootStyle = document.documentElement.style;

    // --- COLOR CUSTOMIZATION ---
    function applyColor(paramName, cssVar) {
        const value = params.get(paramName);
        if (value) {
            // Check if it's a 6-digit hex code
            const finalValue = value.length === 6 ? '#' + value : value;
            rootStyle.setProperty(cssVar, finalValue);
        }
    }
    // Apply colors if provided via data- attributes
    applyColor("primary_color", "--primary-color");
    applyColor("accent_color", "--accent-color");
    applyColor("header_color", "--header-color");
    applyColor("text_color", "--text-color");
    applyColor("bg_color", "--bg-color");

    // --- POSTMESSAGE UTILITY FUNCTION (Unchanged) ---
    function sendHeight() {
        const root = document.getElementById("footer-root");
        const height = root.scrollHeight; 
        const frameId = params.get("frame_id"); 

        if (frameId) {
            window.parent.postMessage(
                { frameHeight: height, frameId: frameId }, 
                '*' 
            );
        }
    }

    // --- Populate Company Info ---
    const companyName = params.get("company_name") || "Your Company";
    document.getElementById("company-name").textContent = decodeURIComponent(companyName);
    const description = params.get("description");
    if (description) {
        document.getElementById("company-description").textContent = decodeURIComponent(description);
    }

    // --- Populate Navigation Links (up to 8) ---
    const navLinksContainer = document.getElementById("nav-links-container");
    let navLinkCount = 0;
    for (let i = 1; i <= 8; i++) {
        const label = params.get(`link${i}_label`);
        const href = params.get(`link${i}_href`);
        if (label && href) {
            // Use decodeURIComponent on the label
            navLinksContainer.innerHTML += `<a href="${href}" target="_parent">${decodeURIComponent(label)}</a>`;
            navLinkCount++;
        }
    }
    if (navLinkCount === 0) { // Default nav links
        navLinksContainer.innerHTML = `<a href="#" target="_parent">Home</a><a href="#" target="_parent">About</a><a href="#" target="_parent">Services</a>`;
    }

    // --- Populate Social Links (up to 8) ---
    const socialContainer = document.getElementById("social-links-container");
    let socialCount = 0;
    for (let i = 1; i <= 8; i++) {
        const icon = params.get(`social${i}_icon`);
        const href = params.get(`social${i}_href`);
        if (icon && href) {
            socialContainer.innerHTML += `<a href="${href}" target="_blank" rel="noopener noreferrer"><i class="fab fa-${icon}"></i></a>`;
            socialCount++;
        }
    }
    if (socialCount === 0) { // Default social links
        socialContainer.innerHTML = `<a href="#"><i class="fab fa-twitter"></i></a><a href="#"><i class="fab fa-instagram"></i></a><a href="#"><i class="fab fa-linkedin"></i></a>`;
    }

    // --- Populate Copyright ---
    const copyrightParam = params.get("copyright");
    const defaultCopyright = `&copy; ${new Date().getFullYear()} ${companyName}. All Rights Reserved.`;
    document.getElementById("copyright-text").innerHTML = copyrightParam ? decodeURIComponent(copyrightParam) : defaultCopyright;
    
    // --- EVENT LISTENERS FOR RESIZING ---
    window.addEventListener('load', () => {
        sendHeight();
        window.addEventListener('resize', sendHeight);
    });
    // Fallback to catch elements loaded after window load
    setTimeout(sendHeight, 100); 
</script>

</body>
</html>