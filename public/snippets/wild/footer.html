<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wild Footer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap');
        :root { --bg: #1a1a1a; --text: #ffffff; --accent: #82cf66; }
        body { margin: 0; padding: 4rem 2rem; font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; }
        .footer-container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 1.5fr 1fr 1fr 1.5fr; gap: 3rem; }
        h3 { font-size: 1.5rem; margin: 0 0 1rem 0; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .logo-dot { width: 12px; height: 12px; background: var(--accent); border-radius: 50%; display: inline-block; box-shadow: 0 0 10px var(--accent); }
        p { color: #888; line-height: 1.6; font-size: 0.95rem; }
        h4 { font-size: 1rem; margin: 0 0 1.5rem 0; color: #fff; }
        a { display: block; color: #888; text-decoration: none; margin-bottom: 0.8rem; transition: color 0.2s; }
        a:hover { color: var(--accent); }
        .newsletter input { width: 100%; padding: 12px 16px; border-radius: 12px; border: 1px solid #333; background: #222; color: white; font-family: inherit; margin-bottom: 10px; box-sizing: border-box; }
        .newsletter button { width: 100%; padding: 12px; border-radius: 12px; background: var(--accent); color: #1a1a1a; border: none; font-weight: 700; cursor: pointer; }
        .copyright { margin-top: 4rem; padding-top: 2rem; border-top: 1px solid #333; text-align: center; color: #666; font-size: 0.9rem; }
        
        /* Loading & Error States */
        #loading, #error-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: var(--bg); color: var(--text); z-index: 9999;
        }
        #error-screen { background: #fee2e2; color: #b91c1c; display: none; }
        #snippet-content { display: none; }

        @media (max-width: 768px) { .footer-container { grid-template-columns: 1fr; gap: 2rem; } }
    </style>
</head>
<body>
    <div id="loading">
        <div>ðŸ”’ Verifying...</div>
    </div>
    <div id="error-screen">
        <h3>Access Denied</h3>
        <p id="error-msg">Invalid Token</p>
    </div>

    <div id="snippet-content">
        <div class="footer-container">
            <div>
                <h3 id="brand"><span class="logo-dot"></span> Wild.</h3>
                <p id="desc">Creating digital experiences that are bold, playful, and human-centered.</p>
            </div>
            <div>
                <h4>Company</h4>
                <a href="#">About</a>
                <a href="#">Careers</a>
                <a href="#">Blog</a>
            </div>
            <div>
                <h4>Resources</h4>
                <a href="#">Documentation</a>
                <a href="#">Help Center</a>
                <a href="#">Partners</a>
            </div>
            <div class="newsletter">
                <h4>Stay in the loop</h4>
                <input type="email" placeholder="Email address">
                <button>Subscribe</button>
            </div>
        </div>
        <div class="copyright" id="copy">Â© 2025 Wild Theme. All rights reserved.</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC4qRfl2vU7rWZlQsgN5ikrtLTgzS9ehN4",
            authDomain: "komutheme.firebaseapp.com",
            projectId: "komutheme",
            storageBucket: "komutheme.firebasestorage.app",
            messagingSenderId: "27957638694",
            appId: "1:27957638694:web:daf2e849b28b46740e58e7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const params = new URLSearchParams(window.location.search);
        const token = params.get('token');
        const frameId = params.get('frame_id');

        async function verifyToken() {
            if (!token) return showError("No token provided.");
            try {
                await signInAnonymously(auth);
                const q = query(collection(db, "users"), where("premiumToken", "==", token));
                const querySnapshot = await getDocs(q);
                if (!querySnapshot.empty) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('snippet-content').style.display = 'block';
                    renderContent();
                } else showError("Token not found.");
            } catch (e) { console.error(e); showError("Verification failed."); }
        }

        function showError(msg) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error-screen').style.display = 'flex';
            document.getElementById('error-msg').innerText = msg;
            sendHeight();
        }

        function renderContent() {
            if(params.get('brand')) document.getElementById('brand').innerHTML = `<span class="logo-dot"></span> ${params.get('brand')}`;
            if(params.get('description')) document.getElementById('desc').textContent = params.get('description');
            if(params.get('copyright')) document.getElementById('copy').textContent = params.get('copyright');
            if(params.get('bg_color')) document.body.style.backgroundColor = '#' + params.get('bg_color');
            if(params.get('accent_color')) document.documentElement.style.setProperty('--accent', '#'+params.get('accent_color'));
            sendHeight();
        }
        
        // 3. Resizing logic (always works even if locked)
        const sendHeight = () => { 
            if(frameId) {
                window.parent.postMessage({
                    frameId: frameId, 
                    frameHeight: document.body.scrollHeight
                }, '*'); 
            }
        }
        window.addEventListener('resize', sendHeight);
        verifyToken();
    </script>
</body>
</html>